<div class="main-content">
    <div class="consulta-container">
      <!-- Panel izquierdo - Información del paciente -->
      <div class="profile-panel">
        <div class="profile-photo">
          <div *ngIf="!pacientePhotoUrl" class="profile-placeholder">
            <span class="profile-initials">{{ getInitials() }}</span>
          </div>
          <img *ngIf="pacientePhotoUrl" [src]="pacientePhotoUrl" alt="Foto del paciente" class="patient-photo">
        </div>
  
        <div class="profile-details">
          <h2 class="patient-name" *ngIf="paciente">
            {{ paciente.nombre }} {{ paciente.apellidos }}
          </h2>
          <p class="patient-id" *ngIf="paciente">C.C. {{ paciente.numero_documento }}</p>
          <p class="doctor-info">
            <ng-container *ngIf="!cargandoDoctor">Dr. {{ nombreDoctor }}</ng-container>
            <ng-container *ngIf="cargandoDoctor">Cargando...</ng-container>
          </p>
        </div>
  
        <div class="action-buttons">
          <button class="btn-cancel" (click)="cancelar()">Cancelar</button>
          <button type="button" class="btn-save" (click)="guardarConsulta()" [disabled]="guardando" >  <div *ngIf="guardando" class="spinner-small"></div>
            <span *ngIf="!guardando">Guardar Consulta</span>
            <span *ngIf="guardando">Guardando...</span></button>
        </div>
      </div>
  
      <!-- Panel derecho - Formulario de consulta -->
      <div class="right-panel">
        <form [formGroup]="consultaForm">
          <!-- Sección: Datos de la consulta -->
          <div class="data-section">
            <h3 class="section-title">Datos de la consulta</h3>
            <div class="section-divider"></div>
  
            <div class="data-grid">
              <div class="data-row">
                <div class="data-field-label">Motivo de consulta</div>
                <div class="data-field-input">
                  <input type="text" formControlName="motivo" placeholder="Ingrese el motivo">
                </div>
              </div>
  
              <div class="data-row alt-bg">
                <div class="data-field-label">Enfermedad actual</div>
                <div class="data-field-input">
                  <textarea formControlName="enfermedad_actual" placeholder="Describa la enfermedad actual"></textarea>
                </div>
              </div>
  
              <div class="data-row">
                <div class="data-field-label">Objetivos terapéuticos</div>
                <div class="data-field-input">
                  <textarea formControlName="objetivos_terapia" placeholder="Describa los objetivos"></textarea>
                </div>
              </div>
  
              <div class="data-row alt-bg">
                <div class="data-field-label">Historia del problema</div>
                <div class="data-field-input">
                  <textarea formControlName="historia_problema" placeholder="Describa la historia del problema"></textarea>
                </div>
              </div>
  
              <div class="data-row">
                <div class="data-field-label">Desarrollo de la sesión</div>
                <div class="data-field-input">
                  <textarea formControlName="desarrollo" placeholder="Describa el desarrollo"></textarea>
                </div>
              </div>
  
              <div class="data-row alt-bg">
                <div class="data-field-label">Anotaciones adicionales</div>
                <div class="data-field-input">
                  <textarea formControlName="plan_terapeutico" placeholder="Describa anotaciones adicionales"></textarea>
                </div>
              </div>
            </div>
          </div>
  
          <!-- Sección: Diagnóstico -->
          <div class="data-section">
            <h3 class="section-title">Diagnóstico</h3>
            <div class="section-divider"></div>
  
            <div class="data-grid">
              <div class="data-row">
                <div class="data-field-label">Tipo de diagnóstico</div>
                <div class="data-field-input">
                  <input type="text" formControlName="tipo_diagnostico" placeholder="Especifique el tipo">
                </div>
              </div>
  
              <div class="data-row alt-bg">
                <div class="data-field-label">Análisis diagnóstico</div>
                <div class="data-field-input">
                  <textarea formControlName="analisis_diagnostico" placeholder="Describa el análisis"></textarea>
                </div>
              </div>
            </div>
          </div>
  
          <!-- Sección: Plan y tratamiento -->
          <div class="data-section">
            <h3 class="section-title">Plan y tratamiento</h3>
            <div class="section-divider"></div>
  
            <div class="data-grid">
              <div class="data-row">
                <div class="data-field-label">Plan de tratamiento</div>
                <div class="data-field-input">
                  <textarea formControlName="plan_tratamiento" placeholder="Describa el plan"></textarea>
                </div>
              </div>
  
              <div class="data-row alt-bg">
                <div class="data-field-label">Recomendaciones</div>
                <div class="data-field-input">
                  <textarea formControlName="recomendaciones" placeholder="Ingrese recomendaciones"></textarea>
                </div>
              </div>
            </div>
          </div>
  
          <!-- Sección: Consentimiento informado -->
          <div class="data-section">
            <h3 class="section-title">Consentimiento informado</h3>
            <div class="section-divider"></div>
  
            <div class="consent-section">
              <div class="tipo-consentimiento">
                <label for="tipo_consentimiento">Seleccione tipo de consentimiento:</label>
                <select id="tipo_consentimiento" (change)="seleccionarTipoConsentimiento($event)" class="form-select">
                  <option value="">Seleccione un tipo...</option>
                  <option value="general">Consentimiento General</option>
                  <option value="procedimiento">Procedimiento Específico</option>
                  <option value="terapia">Terapia Avanzada</option>
                </select>
              </div>
  
              <div *ngIf="tipoConsentimientoSeleccionado" class="consentimiento-preview">
                <div id="documento-consentimiento" [ngClass]="tipoConsentimientoSeleccionado">
                  <div class="consentimiento-header">
                    <h3>CONSENTIMIENTO INFORMADO - {{obtenerTituloConsentimiento()}}</h3>
                    <div class="consentimiento-info">
                      <p><strong>Fecha:</strong> {{fechaActual | date:'dd/MM/yyyy'}}</p>
                      <p><strong>Paciente:</strong> {{paciente?.nombre}} {{paciente?.apellidos}}</p>
                      <p><strong>Documento:</strong> {{paciente?.numero_documento}}</p>
                      <p><strong>Doctor:</strong> {{nombreDoctor}}</p>
                    </div>
                  </div>
  
                  <div *ngIf="tipoConsentimientoSeleccionado === 'general'" class="consentimiento-body">
                    <p>Yo, <strong>{{paciente?.nombre}} {{paciente?.apellidos}}</strong>, mayor de edad, con documento de identidad No. <strong>{{paciente?.numero_documento}}</strong>, por medio del presente documento dejo constancia que he sido informado(a) adecuadamente sobre mi diagnóstico, alternativas de tratamiento y pronóstico relacionados con mi condición médica actual.</p>
                    
                    <p>Entiendo que:</p>
                    <ul>
                      <li>He recibido información clara y comprensible sobre mi condición de salud.</li>
                      <li>Se me han explicado los riesgos y beneficios de los procedimientos recomendados.</li>
                      <li>He tenido la oportunidad de hacer preguntas y estas han sido respondidas satisfactoriamente.</li>
                      <li>Puedo revocar este consentimiento en cualquier momento antes del procedimiento.</li>
                    </ul>
  
                    <p>Por lo tanto, autorizo al Dr. {{nombreDoctor}} y su equipo médico para realizar los procedimientos diagnósticos y terapéuticos que consideren necesarios para mi tratamiento médico.</p>
                  </div>
  
                  <!-- Otros tipos de consentimiento... -->
  
                  <div class="firma-section">
                    <div class="firma-container">
                      <div class="firma-paciente">
                        <p>Firma del paciente:</p>
                        <div class="firma-canvas-container" [class.has-firma]="firmaPaciente">
                          <canvas #firmaPacienteCanvas class="firma-canvas" width="280" height="120"></canvas>
                          <div class="firma-placeholders">
                            <div class="firma-linea"></div>
                            <p class="firma-nombre">{{paciente?.nombre}} {{paciente?.apellidos}}</p>
                          </div>
                          <div class="firma-controls">
                            <button type="button" class="btn-firma btn-clear" (click)="limpiarFirma('paciente')">
                              <i class="fas fa-eraser"></i> Borrar
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="firma-doctor">
                        <p>Firma del médico:</p>
                        <div class="firma-canvas-container" [class.has-firma]="firmaDoctor">
                          <canvas #firmaDoctorCanvas class="firma-canvas" width="280" height="120"></canvas>
                          <div class="firma-placeholders">
                            <div class="firma-linea"></div>
                            <p class="firma-nombre">Dr. {{nombreDoctor}}</p>
                          </div>
                          <div class="firma-controls">
                            <button type="button" class="btn-firma btn-clear" (click)="limpiarFirma('doctor')">
                              <i class="fas fa-eraser"></i> Borrar
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <p class="fecha-firma">Fecha: {{fechaActual | date:'dd/MM/yyyy'}}</p>
                    <div class="firma-instructions">
                      <p><i class="fas fa-info-circle"></i> Firme haciendo clic y arrastrando en las áreas designadas</p>
                    </div>
                  </div>
                </div>
              </div>
  
              <div class="consent-actions">
                <div class="consent-checkbox">
                  <input type="checkbox" id="consentimiento_check" formControlName="consentimiento_check">
                  <label for="consentimiento_check">El paciente ha leído y aceptado los términos</label>
                </div>
                
                <button type="button" class="btn-preview" [disabled]="!tipoConsentimientoSeleccionado" (click)="generarPDF()">
                  Generar PDF
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>