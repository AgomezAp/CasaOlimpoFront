<h1 class="page-title">Pacientes</h1> 
<div class="main-content">
  <div class="content-container">
    
    <!-- Barra de búsqueda y botón de nuevo paciente -->
    <div class="controls-row">
      <div class="search-box">
        <input type="text" placeholder="Buscar pacientes..." [(ngModel)]="searchTerm" (input)="filtrarPacientes()">
        <i class="search-icon"></i>
      </div>
      <button class="btn-new" (click)="nuevoPaciente()">Nuevo Paciente</button>
    </div>
    
    <!-- Tabla de pacientes - IMPORTANTE: usa pacientesPaginados aquí -->
    <div class="table-container">
      <table class="patients-table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Edad</th>
            <th>Cédula</th>
            <th>Teléfono</th>
            <th>Fecha de Nacimiento</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let paciente of pacientesPaginados; let i = index" [ngClass]="{'odd-row': i % 2 !== 0}">
            <td>{{paciente.nombre}}</td>
            <td>{{paciente.apellidos}}</td>
            <td>{{calcularEdad(paciente.fecha_nacimiento)}}</td>
            <td>{{paciente.numero_documento}}</td>
            <td>{{paciente.telefono}}</td>
            <td>{{paciente.fecha_nacimiento | date:'dd/MM/yyyy'}}</td>
            <td class="actions">
                <button class="btn-view" (click)="verPaciente(paciente)">
                    <img src="/Pacientes.png" alt="Ver Paciente" class="btn-icon">
                </button>
            </td>
          </tr>
          <tr *ngIf="pacientes.length === 0 && !loading">
            <td colspan="7" class="no-data">No hay pacientes registrados</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Paginación mejorada -->
    <div class="pagination-container" *ngIf="totalPaginas > 0">
      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          [disabled]="paginaActual === 1" 
          (click)="anteriorPagina()">
          <span class="pagination-arrow">←</span> Anterior
        </button>
        
        <!-- Primera página -->
        <button 
          *ngIf="paginaActual > 3" 
          class="pagination-page-btn"
          (click)="irAPagina(1)">
          1
        </button>
        
        <!-- Puntos suspensivos si es necesario -->
        <span *ngIf="paginaActual > 3" class="pagination-ellipsis">...</span>
        
        <!-- Páginas centrales (usando nuestro método dedicado) -->
        <button 
          *ngFor="let page of getPaginasVisibles()" 
          class="pagination-page-btn"
          [class.active]="paginaActual === page"
          (click)="irAPagina(page)">
          {{ page }}
        </button>
        
        <!-- Puntos suspensivos finales si es necesario -->
        <span *ngIf="paginaActual < totalPaginas - 2" class="pagination-ellipsis">...</span>
        
        <!-- Última página -->
        <button 
          *ngIf="paginaActual < totalPaginas - 2 && totalPaginas > 5" 
          class="pagination-page-btn"
          (click)="irAPagina(totalPaginas)">
          {{ totalPaginas }}
        </button>
        
        <button 
          class="pagination-btn"
          [disabled]="paginaActual === totalPaginas" 
          (click)="siguientePagina()">
          Siguiente <span class="pagination-arrow">→</span>
        </button>
      </div>
      
      <!-- Información de paginación -->
      <div class="pagination-info">
        Mostrando {{ Math.min((paginaActual - 1) * pacientesPorPagina + 1, pacientes.length) }} - 
        {{ Math.min(paginaActual * pacientesPorPagina, pacientes.length) }} 
        de {{ pacientes.length }} pacientes
      </div>
    </div>
    
    <!-- Indicador de carga -->
    <div *ngIf="loading" class="loader-container">
      <div class="loader"></div>
    </div>
    
    <!-- Mensaje de error -->
    <div *ngIf="error" class="error-message">
      {{error}}
    </div>
  </div>
</div>