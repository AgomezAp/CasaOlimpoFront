<div class="data-section">
  <h3 class="section-title">Consentimiento informado</h3>
  <div class="section-divider"></div>
  <form [formGroup]="consentimientoForm">
    <div class="consent-section">
      <div class="tipo-consentimiento">
        <label for="tipo_consentimiento"
          >Seleccione tipo de consentimiento:</label
        >
        <select
          id="tipo_consentimiento"
          (change)="seleccionarTipoConsentimiento($event)"
          class="form-select"
        >
          <option value="">Seleccione un tipo...</option>
          <option value="general">Consentimiento General</option>
          <option value="procedimiento">Procedimiento Específico</option>
          <option value="terapia">Terapia Avanzada</option>
        </select>
      </div>

      <div
        *ngIf="tipoConsentimientoSeleccionado"
        class="consentimiento-preview"
      >
        <div
          id="documento-consentimiento"
          [ngClass]="tipoConsentimientoSeleccionado"
        >
          <div class="consentimiento-header">
            <h3>
              CONSENTIMIENTO INFORMADO - {{ obtenerTituloConsentimiento() }}
            </h3>
            <div class="consentimiento-info">
              <p>
                <strong>Fecha:</strong> {{ fechaActual | date : "dd/MM/yyyy" }}
              </p>
              <p>
                <strong>Paciente:</strong> {{ paciente?.nombre }}
                {{ paciente?.apellidos }}
              </p>
              <p>
                <strong>Documento:</strong> {{ paciente?.numero_documento }}
              </p>
              <p><strong>Doctor:</strong> {{ nombreDoctor }}</p>
            </div>
          </div>

          <div
            *ngIf="tipoConsentimientoSeleccionado === 'general'"
            class="consentimiento-body"
          >
            <p>
              Yo,
              <strong>{{ paciente?.nombre }} {{ paciente?.apellidos }}</strong
              >, mayor de edad, con documento de identidad No.
              <strong>{{ paciente?.numero_documento }}</strong
              >, por medio del presente documento dejo constancia que he sido
              informado(a) adecuadamente sobre mi diagnóstico, alternativas de
              tratamiento y pronóstico relacionados con mi condición médica
              actual.
            </p>

            <p>Entiendo que:</p>
            <ul>
              <li>
                He recibido información clara y comprensible sobre mi condición
                de salud.
              </li>
              <li>
                Se me han explicado los riesgos y beneficios de los
                procedimientos recomendados.
              </li>
              <li>
                He tenido la oportunidad de hacer preguntas y estas han sido
                respondidas satisfactoriamente.
              </li>
              <li>
                Puedo revocar este consentimiento en cualquier momento antes del
                procedimiento.
              </li>
            </ul>

            <p>
              Por lo tanto, autorizo al Dr. {{ nombreDoctor }} y su equipo
              médico para realizar los procedimientos diagnósticos y
              terapéuticos que consideren necesarios para mi tratamiento médico.
            </p>
          </div>

          <div class="firma-section">
            <div class="firma-container">
              <div class="firma-paciente">
                <p>Firma del paciente:</p>
                <div
                  class="firma-canvas-container"
                  [class.has-firma]="firmaPaciente"
                >
                  <canvas
                    #firmaPacienteCanvas
                    class="firma-canvas"
                    width="280"
                    height="120"
                  ></canvas>
                  <div class="firma-placeholders">
                    <div class="firma-linea"></div>
                    <p class="firma-nombre">
                      {{ paciente?.nombre }} {{ paciente?.apellidos }}
                    </p>
                  </div>
                  <div class="firma-controls">
                    <button
                      type="button"
                      class="btn-firma btn-clear"
                      (click)="limpiarFirma('paciente')"
                    >
                      <i class="fas fa-eraser"></i> Borrar
                    </button>
                  </div>
                </div>
              </div>
              <div class="firma-doctor">
                <p>Firma del médico:</p>
                <div
                  class="firma-canvas-container"
                  [class.has-firma]="firmaDoctor"
                >
                  <canvas
                    #firmaDoctorCanvas
                    class="firma-canvas"
                    width="280"
                    height="120"
                  ></canvas>
                  <div class="firma-placeholders">
                    <div class="firma-linea"></div>
                    <p class="firma-nombre">Dr. {{ nombreDoctor }}</p>
                  </div>
                  <div class="firma-controls">
                    <button
                      type="button"
                      class="btn-firma btn-clear"
                      (click)="limpiarFirma('doctor')"
                    >
                      <i class="fas fa-eraser"></i> Borrar
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <p class="fecha-firma">
              Fecha: {{ fechaActual | date : "dd/MM/yyyy" }}
            </p>
            <div class="firma-instructions">
              <p>
                <i class="fas fa-info-circle"></i> Firme haciendo clic y
                arrastrando en las áreas designadas
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="consent-actions">
        <div class="consent-checkbox">
          <input
            type="checkbox"
            id="consentimiento_check"
            formControlName="consentimiento_check"
          />
          <label for="consentimiento_check"
            >El paciente ha leído y aceptado los términos</label
          >
        </div>

        <button
          type="button"
          class="btn-preview"
          [disabled]="!tipoConsentimientoSeleccionado"
          (click)="generarPDF()"
        >
          Generar y Guardar PDF
        </button>
      </div>
    </div>
  </form>
</div>
